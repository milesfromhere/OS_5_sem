#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –≤—ã–≤–æ–¥–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∏ —Ñ–∞–π–ª–æ–≤ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
format_size() {
    local size=$1
    local units=("B" "KB" "MB" "GB")
    local unit_index=0
    
    while [[ $size -ge 1024 && $unit_index -lt 3 ]]; do
        size=$((size / 1024))
        ((unit_index++))
    done
    
    echo "${size} ${units[$unit_index]}"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Ñ–∞–π–ª–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–±–µ–∑ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π)
count_files_in_dir() {
    local dir="$1"
    local count=0
    
    if [[ -d "$dir" && -r "$dir" ]]; then
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º find –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
        count=$(find "$dir" -maxdepth 1 -type f 2>/dev/null | wc -l)
    fi
    
    echo $count
}

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
main() {
    local target_dir="${1:-.}"  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    
    if [[ ! -d "$target_dir" ]]; then
        echo "–û—à–∏–±–∫–∞: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è '$target_dir' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"
        return 1
    fi
    
    echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: $target_dir"
    echo "======================================"
    
    # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º –≤ —Ü–µ–ª–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    for item in "$target_dir"/*; do
        if [[ -e "$item" ]]; then
            item_name=$(basename "$item")
            
            if [[ -d "$item" ]]; then
                # –î–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤
                file_count=$(count_files_in_dir "$item")
                echo "üìÅ –î–ò–†–ï–ö–¢–û–†–ò–Ø: $item_name | –§–∞–π–ª–æ–≤ –≤–Ω—É—Ç—Ä–∏: $file_count"
                
            elif [[ -f "$item" ]]; then
                # –î–ª—è —Ñ–∞–π–ª–∞: –ø–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
                if [[ -r "$item" ]]; then
                    size=$(stat -c%s "$item" 2>/dev/null || echo "0")
                    formatted_size=$(format_size $size)
                    echo "üìÑ –§–ê–ô–õ: $item_name | –†–∞–∑–º–µ—Ä: $formatted_size"
                else
                    echo "üìÑ –§–ê–ô–õ: $item_name | –†–∞–∑–º–µ—Ä: –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —á—Ç–µ–Ω–∏–µ)"
                fi
            else
                # –î–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ (—Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏ –∏ —Ç.–¥.)
                echo "üîó –î–†–£–ì–û–ï: $item_name"
            fi
        fi
    done
}

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã
if [[ $# -gt 1 ]]; then
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 [–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è]"
    echo "  –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è - —Ü–µ–ª–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Ç–µ–∫—É—â–∞—è)"
    exit 1
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
main "$1"